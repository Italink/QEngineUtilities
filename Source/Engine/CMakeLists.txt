set(QENGINE_PLUGINS_JSON_FILE ${QENGINE_BINARIES_DIR}/QEnginePlugins.json)

qengine_add_target(QEngineUtilities
    ENABLE_MOC
    PUBLIC_DEPENDENCY   
        QEngineCore
    PRIVATE_DEPENDENCY
        $<$<OR:$<CONFIG:DebugEditor>,$<CONFIG:ReleaseEditor>>:QEngineEditor>
    PUBLIC_DEFINITIONS
        "$<$<OR:$<CONFIG:DebugEditor>,$<CONFIG:ReleaseEditor>>:QENGINE_WITH_EDITOR>"
    PRIVATE_DEFINITIONS
        QENGINE_PLUGINS_JSON_FILE="${QENGINE_PLUGINS_JSON_FILE}"
    SOURCE_GROUP "QEngineUtilities"
)

get_property(QENGINE_TARGET_LIST GLOBAL PROPERTY QENGINE_TARGET_LIST)

set(QENIGNE_PLUGIN_JSON "{}")
foreach(QENGINE_TARGET ${QENGINE_TARGET_LIST})
    get_target_property(PLUGIN_TYPE ${QENGINE_TARGET} PLUGIN_TYPE)
    if(PLUGIN_TYPE)
        add_dependencies( QEngineUtilities ${QENGINE_TARGET})
        string(JSON QENIGNE_PLUGIN_JSON SET ${QENIGNE_PLUGIN_JSON} ${QENGINE_TARGET} "{}")
        string(JSON QENIGNE_PLUGIN_JSON SET ${QENIGNE_PLUGIN_JSON} ${QENGINE_TARGET} Type \"${PLUGIN_TYPE}\")
    endif()
endforeach()

file(WRITE ${QENGINE_PLUGINS_JSON_FILE} ${QENIGNE_PLUGIN_JSON})
